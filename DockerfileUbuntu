FROM ubuntu:20.04
ENV DEBIAN_FRONTEND noninteractive

RUN apt update                                                            
RUN apt install nginx -y                                                 
RUN apt install unzip -y                                                  
RUN apt install curl -y
RUN apt install php7.4-fpm -y                                      
RUN apt install -y                                          \
  php-cli                                                   \
  php-mysql                                                 \
  php-zip                                                   \
  php-soap                                                  \
  php-curl                                                  \
  php-xml                                                   \
  php-mbstring                                              \
  php-bcmath                                                \
  php-pear                                                  \
  php-intl                                                  \
  php-json                                                  \
  php-gd                                                 

# RUN cd ~
# RUN curl -sS https://getcomposer.org/installer -o /tmp/composer-setup.php
# RUN HASH=`curl -sS https://composer.github.io/installer.sig`
# RUN php -r "if (hash_file('SHA384', '/tmp/composer-setup.php') === '$HASH') { echo 'Installer verified'; } else { echo 'Installer corrupt'; unlink('composer-setup.php'); } echo PHP_EOL;"
# RUN php /tmp/composer-setup.php --install-dir=/usr/local/bin --filename=composer

# RUN composer create-project codeigniter4/appstarter /var/www/html/codeigniter
RUN mkdir /var/www/html/codeigniter
RUN chown -R www-data:www-data /var/www/html/codeigniter
# RUN echo "CI_ENVIRONMENT = development" > /var/www/html/codeigniter/.env

EXPOSE 80 443

#VOLUME /var/www/html /var/log/nginx /var/log/php-fpm7.4 /var/lib/php-fpm7.4

COPY ./conf/nginx.conf /etc/nginx/conf.d/default.conf

COPY ./bin/start.sh /start.sh

COPY index.php /var/www/html/index.php

RUN chmod +x /start.sh

CMD /etc/init.d/php7.4-fpm start -F && nginx -g "daemon off;"
